<div id="main" class="playbookMain">
    <div class="d-flex align-items-center">
    <nav aria-label="breadcrumb">
        <ol id="playbookBreadcrumbs" class="breadcrumb">
            <li class="breadcrumb-item">Workflows</li>
            <li class="breadcrumb-item"><a routerLink="" (click)="newWorkflowModal()">Create New...</a></li>
            <!-- <li class="breadcrumb-item active" aria-current="page">My Workflow <a href="#" class="font-weight-normal small">(Workflows)</a></li> -->
        </ol>
    </nav>
    <div class="col-4 my-1 my-lg-none ml-auto pr-0">
		<input class="form-control" [formControl]="filterQuery" placeholder="Filter Workflows..." />
	</div>
    </div>

    <!-- Graph editor toolbar -->
    <div *ngIf="false" id="playbookToolbar" class="btn-toolbar" role=toolbar>
        <div class="btn-group" role="group">
            <button id="new-button" type="button" class="btn btn-default" data-toggle="tooltip" title="New Workflow"
                (click)="newWorkflowModal()">
                <i class="fa fa-file-o"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="load-button" type="button" class="btn btn-default" data-toggle="modal" data-target="#workflowsModal"
                title="Load Workflow">
                <i class="fa fa-folder-open-o"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="save-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Save Workflow"
                [disabled]="!loadedWorkflow" (click)="save()">
                <i class="fa fa-save"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="undo-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Undo"
                [disabled]="!loadedWorkflow || (ur && ur.isUndoStackEmpty())" (click)="ur.undo()">
                <i class="fa fa-undo"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="redo-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Redo"
                [disabled]="!loadedWorkflow || (ur && ur.isRedoStackEmpty())" (click)="ur.redo()">
                <i class="fa fa-repeat"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="remove-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Delete Selected Nodes"
                [disabled]="!loadedWorkflow" (click)="removeSelectedNodes()">
                <i class="fa fa-trash-o"></i>
            </button>
        </div>
        <!-- <div class="btn-group" role="group">
            <button id="cut-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Cut" [disabled]="!loadedWorkflow"
                (click)="cut()">
                <span class="fa fa-cut" style="transform: rotate(-90deg);"></span>
            </button>
        </div> -->
        <div class="btn-group" role="group">
            <button id="copy-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Copy"
                [disabled]="!loadedWorkflow" (click)="copy()">
                <i class="fa fa-copy"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="paste-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Paste"
                [disabled]="!loadedWorkflow" (click)="paste()">
                <i class="fa fa-paste"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="execute-button" type="button" class="btn btn-default" data-toggle="tooltip" title="Execute Workflow"
                [disabled]="!loadedWorkflow || !loadedWorkflow.is_valid" (click)="executeWorkflow()">
                <i class="fa fa-play-circle"></i>
            </button>
        </div>
        <div class="btn-group" role="group">
            <button id="clear-execution-highlighting-button" type="button" class="btn btn-default" data-toggle="tooltip"
                title="Clear Execution Results" [disabled]="!loadedWorkflow || !loadedWorkflow.is_valid" (click)="clearExecutionResults()">
                <i class="fa fa-eraser"></i>
            </button>
        </div>
        <!-- <label *ngIf="loadedWorkflow" id="currentWorkflowText" class="mr-1">{{loadedPlaybook.name}} -</label> -->
        <input *ngIf="loadedWorkflow" type="text" class="form-control workflowNameInput my-auto ml-3" [(ngModel)]="loadedWorkflow.name"
            name="name" required>
        <label *ngIf="loadedWorkflow && !loadedWorkflow?.is_valid" class="my-auto" id="currentWorkflowText">(In Progress)</label>
    </div>
    <!-- Graph editor -->
    <div class="row">

            <div *ngFor="let w of filteredWorkflows" class="col-md-6 col-lg-4 col-xl-3 my-4">
                    <div class="card workflow-card shadow">
                            <div ngbDropdown placement="bottom-right" class="d-inline-block workflow-menu mt-3">
                                    <a class="workflow-menu-link text-muted h2 px-3" ngbDropdownToggle><i class="fa fa-ellipsis-v"></i></a>
                                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                      <button class="dropdown-item" (click)="editDescription(w)">Edit Description...</button>
                                      <button class="dropdown-item" (click)="duplicateWorkflowModal(w.id)">Duplicate</button>
                                      <button class="dropdown-item" (click)="deleteWorkflow(w)">Delete</button>
                                    </div>
                                  </div>
                            <div class="card-body d-flex flex-column">
                                    
                              <h5 class="card-title">
                                    {{ w.name }}
                                    <div *ngIf="w.tags?.length > 0" class="small mt-1">
                                        <span *ngFor="let tag of w.tags" class="badge badge-pill badge-primary small mr-1"> {{ tag }} </span>
                                    </div>
                              </h5>
                              
                              <p class="card-text flex-grow-1">{{ w.description }}</p>
                              <div class="d-flex justify-content-around">
                                  <button class="btn btn-outline-primary" (click)="routeToWorkflow(w)"><i class="fa fa-sitemap"></i> Workflow Editor</button>
                                  <button class="btn btn-outline-primary" [disabled]="!w.is_valid"  ><i class="fa fa-play-circle"></i> Execute Workflow</button>
                                </div>
                            </div>
                    </div>
                </div>

        <!-- <div *ngFor="let w of [1,2,3,4,5,6,7]" class="col-md-6 col-lg-4 col-xl-3 my-4">
            <div class="card workflow-card shadow">
                    <div class="card-body d-flex flex-column">
                            <div ngbDropdown placement="bottom-right" class="d-inline-block">
                                    <a class="workflow-menu text-muted h2 m-0 px-3" ngbDropdownToggle><i class="fa fa-ellipsis-v"></i></a>
                                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                      <button class="dropdown-item">Edit Metadata...</button>
                                      <button class="dropdown-item">Duplicate</button>
                                      <button class="dropdown-item">Delete</button>
                                    </div>
                                  </div>
                                  <h5 class="card-title flex-shrink-0">
                                        Special title treatment
                                        <div *ngIf="w != 3" class="small mt-1">
                                            <span *ngFor="let tag of ['UI', 'Automation', 'Bro']" class="badge badge-pill badge-primary small mr-1"> {{ tag }} </span>
                                        </div>
                                  </h5>
                      <p class="card-text flex-grow-1 flex-shrink-1">With supporting text below as a natural lead-in to additional contentWith supporting text below as a natural lead-in to additional contentWith supporting text below as a natural lead-in</p>
                      <div class="d-flex flex-shrink-0 justify-content-around">
                          <button class="btn btn-outline-primary"><i class="fa fa-sitemap"></i> Workflow Editor</button>
                          <button class="btn btn-outline-primary"><i class="fa fa-play-circle"></i> Execute Workflow</button>
                        </div>
                    </div>
            </div>
        </div> -->

    </div>

    <div class="modal fade" id="playbookAndWorkflowActionModal" role="dialog" aria-labelledby="playbookAndWorkflowActionModalTitle"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="playbookAndWorkflowActionModalTitle">{{modalParams.title}}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- <div *ngIf="modalParams.shouldShowPlaybook" class="form-group">
                        <h6>{{modalParams.shouldShowExistingPlaybooks ? 'Select a Playbook' : 'Enter a Playbook'}}</h6>
                        <select *ngIf="modalParams.shouldShowExistingPlaybooks" name="playbookSelect" id="playbookSelect"
                            [(ngModel)]="modalParams.selectedPlaybookId" class="form-control">
                            <option [ngValue]="''">-- Create new Playbook --</option>
                            <option *ngFor="let i of playbooks" [ngValue]="i.id" [label]="i.name">{{i.name}}</option>
                        </select>
                        <input type="text" *ngIf="modalParams.selectedPlaybookId === '' || !modalParams.shouldShowExistingPlaybooks" 
                            [(ngModel)]="modalParams.newPlaybook" class="form-control mt-2" placeholder="Enter a new playbook name">
                    </div> -->
                    <div *ngIf="modalParams.shouldShowWorkflow" class="form-group">
                        <h6>Enter a Workflow Name</h6>
                        <input type="text" [(ngModel)]="modalParams.newWorkflow" class="form-control" placeholder="Workflow Name">
                    </div>
                    <div *ngIf="modalParams.shouldShowWorkflow" class="form-group">
                        <h6>Enter a Description (Optional)</h6>
                        <textarea name="description" rows="3" [(ngModel)]="modalParams.newDescription" class="form-control" placeholder="Description (Optional)"></textarea>
                    </div>
                    <div *ngIf="modalParams.shouldShowWorkflow" class="form-group">
                        <h6>Add Tags (Optional)</h6>
                        <select2 [data]="['apples', 'oranges', 'grapes']" [value]="modalParams.newTags" [options]="{ multiple: true, tags: true, width: '100%', placeholder: 'Add Tags...' }" (valueChanged)="changed($event)"></select2>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" (click)="modalParams.submit()">{{modalParams.submitText}}</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="workflowsModal" role="dialog" aria-labelledby="workflowModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="workflowModalTitle">Playbooks and Workflows</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="importContainer">
                        <h5>Import Playbook</h5>
                        <div class="pull-right">
                            <input #importFile type="file" name="file" id="file" class="importPlaybookInput" (change)="onImportSelectChange($event)" />
                            <button [disabled]="!playbookToImport" (click)="importPlaybook()" class="btn btn-primary btn-sm"
                                title="Import Playbook">
                                <i class="fa fa-upload"></i>
                            </button>
                        </div>
                    </div>
                    <div class="panel-group" id="workflowAccordion">
                        <div class="card card-default">
                            <div class="card-heading playbook-heading" data-toggle="collapse" [attr.data-target]="'#loadWorkflowCollapse' + removeWhitespace('Workflows')">
                                <h5 class="card-title my-auto p-3">
                                    {{'Workflows'}}
                                    <div class="pull-right">
                                        <!-- <button (click)="renamePlaybookModal($event, playbook)" class="btn btn-primary btn-sm mx-1"
                                            title="Rename Playbook">
                                            <i class="fa fa-i-cursor"></i>
                                        </button>
                                        <button (click)="duplicatePlaybookModal($event, playbook)" class="btn btn-primary btn-sm mx-1"
                                            title="Duplicate Playbook">
                                            <i class="fa fa-copy"></i>
                                        </button>
                                        <button (click)="exportPlaybook($event, playbook)" class="btn btn-primary btn-sm mx-1"
                                            title="Export Playbook">
                                            <i class="fa fa-download"></i>
                                        </button>
                                        <button (click)="deletePlaybook($event, playbook)" class="btn btn-danger btn-sm mx-1"
                                            title="Delete Playbook">
                                            <i class="fa fa-times"></i>
                                        </button> -->
                                    </div>
                                </h5>
                            </div>
                            <div id="loadWorkflowCollapse{{removeWhitespace('Workflows')}}" class="card-collapse collapse">
                                <div class="card-body p-3">
                                    <div *ngFor="let workflow of workflows" class="card card-default workflowPanel my-1">
                                        <div class="card-body my-auto p-2">
                                            <!-- <a (click)="loadWorkflow(playbook, workflow)">{{workflow.name}}</a> -->
                                            <a (click)="routeToWorkflow(workflow)">{{workflow.name}}</a>
                                            <div class="pull-right">
                                                <!-- <button (click)="renameWorkflowModal(playbook.id, workflow.id)" class="btn btn-primary" title="Rename Workflow">
                                                    <i class="fa fa-i-cursor"></i>
                                                </button> -->
                                                <button (click)="duplicateWorkflowModal(workflow.id)"
                                                    class="btn btn-primary btn-sm mx-1" title="Duplicate Workflow">
                                                    <i class="fa fa-copy"></i>
                                                </button>
                                                <button (click)="deleteWorkflow(workflow)" class="btn btn-danger btn-sm mx-1"
                                                    title="Delete Workflow">
                                                    <i class="fa fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>