<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-twothird">
      <h1>Using the WALKOFF API (Querying)</h1>
        <p>In this part of the WALKOFF API tutorial, having authenticated with the WALKOFF instance, we will query it to check if a specific workflow exists, as a precursor to executing it. This is not strictly necessary, but it is simply a demonstration of the API.</p>
        <p>At the end of this tutorial series, we will have developed a script that:</p>
        <ol>
            <li>Takes in address and username arguments for a WALKOFF instance.</li>
            <li>Attempts to authenticate with the WALKOFF instance at that address with the specified username, prompting for a password.</li>
            <li>Refreshs the access token.</li>
            <li>Lists the available workflows.</li>
            <li>If the workflow "Tutorial" exists, executes it.</li>
            <li>Checks the results of the workflow.</li>
            <li>Logs out.</li>
        </ol>
        <p>This part will detail step 4.</p>
        <h4><b>1. Check if the workflow exists</b></h4>
        <p>We'll query the <code>/api/workflows/{workflow_id}</code> endpoint to see if our desired workflow exists.</p>
        <pre><code class="python">
def get_workflow_by_name(self, workflow_name):
    """" Attempts to find a workflow by name and returns its id """
    if self.is_connected:
        r = requests.get(self.url + "/api/workflows",
                         headers=self.auth_header)
        workflows = r.json()
        for workflow in workflows:
            if workflow["name"].lower() == workflow_name.lower():
                return workflow["id"]

        print("Workflow: {} does not exist.".format(workflow_name))

def check_workflow_exists(self, workflow_name):
    workflow_id = self.get_workflow_by_name(workflow_name)
    if self.is_connected and workflow_id is not None:
        print("Querying workflow: {}\t with ID:{}...".format(
            workflow_name, workflow_id)),
        ep = "/api/workflows/{}".format(workflow_id)

        r = requests.get(self.url + ep,
                         headers=self.auth_header,
                         timeout=2)

        if r.status_code == 200:
            print("Workflow: {}\t{} exists".format(workflow_name,
                                                   workflow_id))
            return workflow_id

        elif r.status_code == 404:
            print("Workflow does not exist.")

        else:
            print("Unknown response: {}: {}".format(r.status_code,
                                                    r.json()))
        </code></pre>

        <p>This concludes the tutorial on the API's query functions. Analogous functions can be written to retrieve information on metrics, cases, users, systems, apps, and more. In the next tutorial, we will look at executing and checking workflow results.</p>
        <div align="center" style="border:1px solid blue">
            <h5><a href="Working_with_API_Execution.html">Next >></a></h5>
        </div>
        <h4><b>More in this series:</b></h4>
        <ol>
            <li><a href="Working_with_API_Auth.html">Using the API to authenticate with a WALKOFF instance.</a></li>
            <li><a href="Working_with_API_Execution.html">Using the API to execute a workflow.</a></li>
      </ol>
    </div>

    <div class="w3-third w3-center">
        <i class="fa fa-graduation-cap w3-padding-64 w3-text-blue-grey"></i>
    </div>
    </div>
</div>