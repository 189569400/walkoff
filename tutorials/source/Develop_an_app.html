<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-twothird">
      <h1>Develop an app</h1>
        <h4><b>1. Create a Python package in the apps directory with the name of the app you want to create.</b></h4>
        <p>In this example we will be recreating the some of the functions of the HelloWorld App in the apps directory,
            so we'll call our package HelloWorld. The <code>apps</code> directory should look like this:</p>
        <pre><code class="console">
WALKOFF
|-- apps
  |-- __init__.py
  |-- HelloWorld
    |-- __init__.py
  |-- [Other apps]
        </code></pre>
        <p>The <code>__init__.py</code> can just be an empty file</p>

        <h4><b>2. Create a basic Main class inside of <code>main.py</code></b></h4>
        <p>Inside of the HelloWorld package, we need to create a <code>main.py</code> module. Inside of this module,
        we will define a class called <code>Main</code> which will extend the <code>App</code> class from
            <code>server.appdevice</code> module. This class is the primary interface to the WALKOFF orchestrator.
        There are only two requirements for this class: </p>
        <ol>
            <li>The <code>__init__</code> must take a name and a device parameters</li>
            <li>A method named shutdown must be implemented</li>
        </ol>
        <p>The first requirement is needed to initialize the App's base class. If we expect ant cleanup would be necessary
            to terminate a session with the app, we need to create override a method called "shutdown". I
            n our example, we won't need any so we'll just omit that function.</p>

        <pre><code class="python">
from apps import App

class Main(App):
    def __init__(self, name, device):
        App.__init__(self, name, device)
        </code></pre>

        <h4><b>3. Write some methods</b></h4>
        <p>Each method you write in this class can be turned into an action.  We are going to start with the standard
            "Hello World" action,  an action which takes an argument named "number" and increments it by one, an
            action which returns a specific letter of a string at a given index, and an action which prints a message to
            the console
            </p>
            <pre><code class="python">
from apps import App

class Main(App):
    def __init__(self, name, device):
        App.__init__(self, name, device)

    def hello_world(self, args={}):
        return {"message": "Hello World"}

    def plus_one(self, number_in):
        return number_in + 1

    def get_letter(self, string_in, index):
        return string_in[index]

    def print_message(self, message):
        print(message)

            </code></pre>
        <h4><b>4. Convert the methods to actions</b></h4>
        <p>To mark a method in your class as an action, you decorate the method with the <code>action</code> decorator
            from the apps package. Also note you cannot use <code>@staticmethod</code> or <code>@classmethod</code>
            decorators in combination with the <code>@action</code> decorator, so your actions must be ordinary methods</p>
            <pre><code class="python">
from apps import App, action

class Main(App):
    def __init__(self, name, device):
        App.__init__(self, name, device)

    @action
    def hello_world(self):
        return {"message": "Hello World"}

    @action
    def plus_one(self, number_in):
        return number_in + 1

    @action
    def get_letter(self, string_in, index):
        return string_in[index]

    @action
    def print_message(self, message):
        print(message)
        return 'success'

            </code></pre>
        <h4><b>5. Create the <code>api.yaml</code> YAML metadata file to convert the methods to actions</b></h4>
        <p>For WALKOFF to recognize a method as an action, it must have an entry in the apps's api.yaml file,
            which is located in the app directory. The minimum required entry of the <code>api.yaml</code>
            is as follows:</p>
        <pre><code class="yaml">
walkoff: '0.1'
info:
  title: HelloWorld
  version: 1.0.0
actions:
  hello world:
    run: hello_world
    returns:
      Success:
        schema:
          type: object
          properties:
            message:
              type: string
  plus one:
    run: plus_one
    parameters:
      - name: number_in
        type: number
        required: true
    returns:
      Success:
        schema:
          type: number
  get letter:
    run: get_letter
    parameters:
      - name: string_in
        type: string
        required: true
      - name: index
        type: integer
        required: true
    returns:
      Success:
        schema:
          type: string
  print message:
    run: print_message
    parameters:
      - name: message
        type: string
        required: true
    returns:
      Success:
        schema:
          type: string
        </code></pre>
        <p>Some things to notice about the API specification:</p>
        <ol>
            <li>The top-level name of the action does not necessarily match the "run" field of the action. This name
                will be displayed on web interface, so it can and should be human-readable. The "run" must be the same
                name as the method which describes the action.</li>
            <li>The name of the parameter must match the name of the argument in the action.</li>
            <li>When your action is executed, inputs of different types will be cast into the appropriate types if
                possible, so there should be no reason to cast your arguments into the correct types in the action</li>
            <li>JSON schema descriptions such as limiting the length of the string or the maximum value of a number or
                integer are available to further validate the parameter. To learn more look at
                <a href="App_api_schema.html">App Api Schemas</a>.</li>
            <li>It is good practice to return something from an action to help with debugging your action.</li>
            <li>The return types of the actions are not validated, only the inputs to the actions.</li>
        </ol>
        <p>We should give a little more information to help a user know more about what our app and its actions do. In
            particular, we should include descriptions on the action parameters. These will be rendered on the workflow
            editor and will help a user use your app better.</p>
        <pre><code class="yaml">
walkoff: '0.1'
info:
  title: HelloWorld
  version: 1.0.0
  description: A simple tutorial app
  contact:
    name: Walkoff Team
    email: some_email@company.com
  license:
    name: Creative Commons
actions:
  hello world:
    run: hello_world
    description: Says hello
    returns:
      Success:
        description: A greeting message object
        schema:
          type: object
          properties:
            message:
              description: A greeting
              type: string
              enum: [Hello World]
  plus one:
    run: plus_one
    description: Adds one to a number
    parameters:
      - name: number_in
        description: The number to add to
        type: number
        required: true
        example: 5
    returns:
      Success:
        description: The incremented number
        schema:
          type: number
  get letter:
    run: get_letter
    description: Gets a letter at a specified index from a string
    parameters:
      - name: string_in
        type: string
        required: true
        description: The string which will searched
        example: This is my string
      - name: index
        type: integer
        required: true
        description: The index of the letter
        example: 3
    returns:
      Success:
        description: The letter at the given position
        schema:
          type: string
          example: s
  print message:
    run: print_message
    description: Prints a message to teh screen
    parameters:
      - name: message
        type: string
        required: true
        example: This is my message
    returns:
      Success:
        description: Completed successfully
        schema:
          type: string
          enum: [success]
        </code></pre>
        <p>If you are concerned if your app API is correct, you can do a quick scan by running the
            <code>validateappapi.py</code> script included at the root of the WALKOFF repository.</p>
            <pre><code class="console">
python validateappapi.py --apps HelloWorld
            </code></pre>
        <p>You can see more options using </p>
        <pre><code class="console">
python validateappapi.py --help
        </code></pre>
        <h4><b>Congratulations! You now have made your first WALKOFF app.</b></h4>
        <p>Go have a look in the webapp and see the name of your app included in the "Installed Apps" portion of the
            dashboard and see the actions you defined included in the workflow editor. Next you'll learn how to manage
            your app's dependencies. </p>
        <div align="center" style="border:1px solid blue">
            <h5><a href="Manage_app_dependencies.html">Next >></a></h5>
        </div>
        <h4><b>More</b></h4>
        <h5><a href="Event_driven_app_actions.html">Event-driven app actions</a></h5>
        <h5><a href="Actions_with_multiple_return_codes.html">Action return codes</a></h5>
        <h5><a href="App_api_schema.html">App Api Schemas</a></h5>
    </div>

   <div class="w3-third w3-center">
      <i class="fa fa-graduation-cap w3-padding-64 w3-text-blue-grey"></i>
    </div>
  </div>
</div>
