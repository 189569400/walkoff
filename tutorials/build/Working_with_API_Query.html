<!DOCTYPE html>
<html>
<title>WALKOFF-Automation for All</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
<style>

body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
.w3-navbar,h1,button {font-family: "Montserrat", sans-serif}
.fa-graduation-cap,.fa-flask{font-size:200px}

#headerDiv{
    background-image:url("../../files/images/headerBackground2.png");
    background-size: 50% auto;
    background-repeat: no-repeat;
    background-position:50% 50%;
}

.imageList {
  list-style-type: none;
}

.topLevelList + h5{
  display:none;
}

.fa-circle, .fa-circle-o{
  font-size:12px;
  padding-right:10px;
}

.code{
    background-color:#edf0f4;
    padding:25px;
}


td{
    padding-right:10px;
    margin-bottom: 25px;
    margin-top:25px;
}

.image{
    text-align:center;
}

.image img{
    max-width:100%;
    max-height:100%;
}

.functionality_list li{
    margin-bottom:20px;
}

.tag{
    background-color:#edf0f4;
    text-align:center;
}

img.media-object.image{
    width:100%;
}

.tutorialTable td{
    border-bottom:1px solid black;
}

</style>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
    
<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-blue-grey w3-card-2 w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-opennav w3-right w3-padding-large w3-hover-white w3-large w3-red" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="../../index.html" class="w3-bar-item w3-button w3-padding-large w3-white">Home</a>
    <a href="../../documentation/build/index.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Documentation</a>
    <a href="https://github.com/iadgov/WALKOFF" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Source</a>
    <a href="../../swagger/index.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">API</a>
    <a href="index.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">Tutorials</a>
  </div>

  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-navblock w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
    <a class="w3-padding-large" href="../../documentation/build/index.html">Documentation</a>
    <a class="w3-padding-large" href="https://github.com/iadgov/WALKOFF">Source</a>
    <a class="w3-padding-large" href="../../swagger/index.html">API</a>
    <a class="w3-padding-large" href="index.html">Tutorials</a>
  </div>
</div>

<!-- Header -->
<header id="headerDiv" class="w3-container w3-black w3-center w3-padding-64">
  <h1 class="headerText w3-margin w3-jumbo">WALKOFF</h1>
  <h5 class="headerText w3-margin w3-xxxlarge">Tutorials</h5>
</header>

<div class="w3-row-padding w3-padding-64 w3-container">
  <div class="w3-content">
    <div class="w3-twothird">
      <h1>Using the WALKOFF API (Querying)</h1>
        <p>In this part of the WALKOFF API tutorial, having authenticated with the WALKOFF instance, we will query it to check if a specific workflow exists, as a precursor to executing it. This is not strictly necessary, but it is simply a demonstration of the API.</p>
        <p>At the end of this tutorial series, we will have developed a script that:</p>
        <ol>
            <li>Takes in address and username arguments for a WALKOFF instance.</li>
            <li>Attempts to authenticate with the WALKOFF instance at that address with the specified username, prompting for a password.</li>
            <li>Refreshs the access token.</li>
            <li>Lists the available workflows.</li>
            <li>If the playbook "Tutorials" has a workflow "Triggers", executes it.</li>
            <li>Using the resulting <code>execution_uid</code>, provides data to any triggers waiting in that workflow.
            <li>Checks the results of the workflow.</li>
            <li>Logs out.</li>
        </ol>
        <p>This part will detail step 4.</p>
        <h4><b>1. Check if the workflow exists</b></h4>
        <p>We'll query the <code>/api/playbooks/{playbook_name}/workflows/{workflow_name}</code> endpoint to see if our desired workflow exists.</p>
        <pre><code class="python">
def check_workflow_exists(self, playbook_name, workflow_name):
    exists = False
    if self.is_connected:
        print("Querying workflow..."),
        ep = "/api/playbooks/{}/workflows/{}".format(
            playbook_name, workflow_name)

        r = requests.get(self.address + ep,
                         headers=self.auth_header,
                         timeout=2)

        if r.status_code == 200:
            exists = True
            print("{}:{} exists".format(
                playbook_name, workflow_name))

        elif r.status_code == 461:
            print("Playbook or workflow does not exist.")

        else:
            print("Unknown response: {}: {}".format(
                r.status_code, r.json()))

    return exists
        </code></pre>

        <p>This concludes the tutorial on the API's query functions. Analogous functions can be written to retrieve information on metrics, cases, users, systems, apps, and more. In the next tutorial, we will look at executing, triggering, and checking workflow results.</p>
        <div align="center" style="border:1px solid blue">
            <h5><a href="Working_with_API_Trigger.html">Next >></a></h5>
        </div>
        <h4><b>More in this series:</b></h4>
        <ol>
            <li><a href="Working_with_API_Auth.html">Using the API to authenticate with a WALKOFF instance.</a></li>
            <li><a href="Working_with_API_Trigger.html">Using the API to provide trigger data to a waiting action.</a></li>
      </ol>
    </div>

    <div class="w3-third w3-center">
        <i class="fa fa-graduation-cap w3-padding-64 w3-text-blue-grey"></i>
    </div>
    </div>
</div>
<div class="w3-container w3-black w3-center w3-opacity w3-padding-64">
    <h1 class="w3-margin w3-xlarge">Questions? Comments? </h1>
    <h1 class="w3-margin w3-xlarge"> Reach out to us at <a href="mailto:walkoff@nsa.gov"> walkoff@nsa.gov </a> </h1>
</div>

<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-center w3-opacity">
 <!-- <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank"> </a></p> -->
</footer>

<script src="../../files/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script>
// Used to toggle the menu on small screens when clicking on the menu button
function myFunction() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>
</body>
</html>
